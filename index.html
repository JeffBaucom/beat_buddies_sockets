<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./node_modules/tone/build/Tone.js"></script>
    <script src="./node_modules/nexusui/dist/NexusUI.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/styles.css">


</head>
<body>
    <div id="content">

    </div>
    <div nexus-ui='sequencer' id="matrix">
    </div>
    <div id="drum-container" class="drums">
      <div id="labels" class="presets">
        <div id="cym-label" class="label"></div>
        <div id="perc1-label" class="label"></div>
        <div id="perc2-label" class="label"></div>
        <div id="tom1-label" class="label"></div>
        <div id="tom2-label" class="label"></div>
        <div id="hh-label" class="label"></div>
        <div id="snare-label" class="label"></div>
        <div id="kick-label" class="label"></div>
      </div>

      <div nexus-ui='sequencer' id="drums" class="drum-matrix">
      </div>
      <div id="drum-selector"></div>
    </div>
    <div id="transport" >
      <div id="tempo" >
        <div nexus-ui='slider' id='tempoSlider'> </div>
        <div nexus-ui='number' id='tempoNumber'></div>
      </div>
      <div id="play-stop" class="d-flex flex-row">
        <div nexus-ui='textbutton' id='play' ></div>
        <div nexus-ui='textbutton' id='stop' ></div>
      </div>
    </div>
    <div id="mixer" class = "d-flex flex-row">

      <div id="kick-channel" class = "kick-channel d-flex flex-column"> Kick</div>

      <div id="snare-channel" class = "snare-channel d-flex flex-column">Snare</div>

      <div id="hh-channel" class ="hh-channel d-flex flex-column">HH</div>

      <div id="tom2-channel" class = "tom2-channel d-flex flex-column">Tom2</div>

      <div id="tom1-channel" class = "tom1-channel d-flex flex-column">Tom1</div>

      <div id="perc2-channel" class = "perc2-channel d-flex flex-column">Perc2</div>

      <div id="perc1-channel" class = "perc1-channel d-flex flex-column">Perc1</div>

      <div id="cym-channel" class = "cym-channel d-flex flex-column">Cym</div>

    </div>
    <script>
    //instantiate the socket:
var socket  = io.connect();


var sequencer = new Nexus.Sequencer("#matrix", {
    'size': [400, 200],
    'mode': 'toggle',
    'rows': 5,
    'columns': 16
});


sequencer.colorize('fill', '#111');

var notes = ['C4', 'D4', 'E4', 'F4', 'G4'];


var synth = new Tone.Synth().toMaster()

var loop = new Tone.Sequence(function(time, row) {
    for (var i = 0; i < 5; i++) {
        if (sequencer.matrix.pattern[i][row] == 1) {
            //console.log(notes[i]);
            synth.triggerAttackRelease(notes[i], '64n');
        }
    }

    for (var j = 0; j < 8; j++) {
        //console.log(drums.matrix.pattern[j][row]);
        if (drums.matrix.pattern[j][row] == 1) {
            //console.log(notes[i]);
            kitSounds.get(kit[j]).start(time, 0, '1n', 0, 0.5);
        }
    }


}
, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], '16n');


// Declare slider and attach to div id
var tempoSlider = new Nexus.Slider('#tempoSlider', {
    'size': [240, 20],
    'min': 1,
    'max': 250,
    'mode': 'absolute',
    'step': 1,
    'value': 110
});

//initialize tempo at current value
Tone.Transport.bpm.value = tempoSlider.value;

var tempoNumber = new Nexus.Number('#tempoNumber');

tempoNumber.link(tempoSlider);

var play = new Nexus.TextButton('#play', {
    'text': 'Play'
});
var stop = new Nexus.TextButton('#stop', {
    'text': 'Stop'
});


Tone.Transport.start();
loop.start();


// ####################################SOCKETS####################################


 // sequencer.on('change', function(v) {
 //     console.log(v);
 // });

// ####################################END SOCKETS####################################


</script>
<script type ="text/javascript" src="./js/drums.js"></script>
<script type ="text/javascript" src="./js/drum_channels.js"></script>
<script type ="text/javascript" src="./js/channel_strip_sockets.js"></script>
<script type ="text/javascript" src="./js/transport.js"></script>


</body>
</html>
