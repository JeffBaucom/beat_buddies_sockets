<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./node_modules/tone/build/Tone.js"></script>
    <script src="./node_modules/nexusui/dist/NexusUI.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/styles.css"> 


</head>
<body>
    <div id="content"></div>
    <div nexus-ui='sequencer' id="matrix"></div>

    <div class="wrapper">
        <div id="transport" class = "d-flex flex-row justify-content-center">
            <div id="drum-selector"></div>

            <div id="tempo" class = "d-flex flex-row justify-content-between">
              <div nexus-ui='slider' id='tempoSlider'> </div>
              <div nexus-ui='number' id='tempoNumber'></div>
            </div>

            <div id="play-stop" class="d-flex flex-row">
              <div nexus-ui='textbutton' id='play' ></div>
              <div nexus-ui='textbutton' id='stop' ></div>
            </div>
        </div>


        <div id="drum-container" class="drums d-flex flex-row justify-content-center">
            <div id="mixer" class = "d-flex flex-column">
                <div class = "button-row d-flex flex-row">
                    <div id="cym-channel-clear" class = "cym-channel d-flex flex-row"></div>
                    <div id="cym-label" class="label"></div>
                    <div id="cym-channel" class = "smButton cym-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="perc1-channel-clear" class = "perc1-channel d-flex flex-row"></div>
                    <div id="perc1-label" class="label"></div>
                    <div id="perc1-channel" class = "smButton perc1-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="perc2-channel-clear" class = "perc2-channel d-flex flex-row"></div>
                    <div id="perc2-label" class="label"></div>
                    <div id="perc2-channel" class = "smButton perc2-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="tom1-channel-clear" class = "tom1-channel d-flex flex-row"></div>
                    <div id="tom1-label" class="label"></div>
                    <div id="tom1-channel" class = "smButton tom1-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="tom2-channel-clear" class = "tom2-channel d-flex flex-row"></div>
                    <div id="tom2-label" class="label"></div>
                    <div id="tom2-channel" class = "smButton tom2-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="hh-channel-clear" class ="hh-channel d-flex flex-row"></div>
                    <div id="hh-label" class="label"></div>
                    <div id="hh-channel" class ="smButton hh-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="snare-channel-clear" class = "snare-channel d-flex flex-row"></div>
                    <div id="snare-label" class="label"></div>
                    <div id="snare-channel" class = "smButton snare-channel d-flex flex-row"></div>
                </div>

                <div class = "button-row d-flex flex-row">
                    <div id="kick-channel-clear" class = "kick-channel d-flex flex-row"></div>
                    <div id="kick-label" class="label"></div>
                    <div id="kick-channel" class = "smButton kick-channel d-flex flex-row"></div>
                </div>
            </div>
          <div nexus-ui='sequencer' id="drums" class="drum-matrix"></div>
        </div>
    </div>
    <script>
    //instantiate the socket:
var socket  = io.connect();

var loop = new Tone.Sequence(function(time, row) {
    for (var i = 0; i < 8; i++) {
        //console.log(drums.matrix.pattern[i][row]);
        if (drums.matrix.pattern[i][row] == 1) {
            //console.log(notes[i]);
            kitSounds.get(kit[i]).start(time, 0, '1n', 0, 0.5);
        }
    }

}
, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], '16n');


// Declare slider and attach to div id
var tempoSlider = new Nexus.Slider('#tempoSlider', {
    'size': [240, 20],
    'min': 1,
    'max': 250,
    'mode': 'absolute',
    'step': 1,
    'value': 110
});

//initialize tempo at current value
Tone.Transport.bpm.value = tempoSlider.value;

var tempoNumber = new Nexus.Number('#tempoNumber');

tempoNumber.link(tempoSlider);

var play = new Nexus.TextButton('#play', {
    'text': 'Play'
});
var stop = new Nexus.TextButton('#stop', {
    'text': 'Stop'
});


Tone.Transport.start();
loop.start();


// ####################################SOCKETS####################################


 // sequencer.on('change', function(v) {
 //     console.log(v);
 // });

// ####################################END SOCKETS####################################

var cssId = './css/styles.css';  // you could encode the css path itself to generate id..
    if (!document.getElementById(cssId))
    {
            var head  = document.getElementsByTagName('head')[0];
            var link  = document.createElement('link');
            link.href   = cssId;
            link.rel  = 'stylesheet';
            head.appendChild(link);

    }

</script>
<script type ="text/javascript" src="./js/drums.js"></script>
<script type ="text/javascript" src="./js/drum_channels.js"></script>
<script type ="text/javascript" src="./js/channel_strip_sockets.js"></script>
<script type ="text/javascript" src="./js/transport.js"></script>


</body>
</html>
