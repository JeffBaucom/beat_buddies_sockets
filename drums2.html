<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./node_modules/tone/build/Tone.js"></script>
    <script src="./node_modules/nexusui/dist/NexusUI.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type ="text/javascript" src="/socket.io/socket.io.js"></script>

</head>
<body>
    <div id="content">

    <!-- </div>
    <div nexus-ui='sequencer' id="matrix">
    </div> -->
    <div nexus-ui='sequencer' id="drums">
    </div>



    <div id="snare-options">

    </div>

    <script>
    $(document).ready(function (){
     var socket  = io.connect();


var drums = new Nexus.Sequencer("#drums", {
    'size': [400, 200],
    'mode': 'toggle',
    // 'matrixLabels': ['Kick', 'HH', 'Snare'],
    'rows': 8,
    'columns': 16
});

drums.colorize('fill', '#547AFF');
drums.colorize("accent","#BAFFAD")


var kit = ['cym','perc2', 'perc1', 'tom1', 'tom2','hh','snare','kick' ]

var kitSounds = new Tone.Players({
  "cym" : "./sounds/cym/crash.wav",
  "perc1" : "./sounds/perc1/clap.WAV",
  "perc2" : "./sounds/perc2/cowbell.wav",
  "tom1" : "./sounds/tom1/tom.wav",
  "tom2" : "./sounds/tom2/tom3.wav",
  "hh" : "./sounds/hh/hh.wav",
  "snare" : "./sounds/snares/snare.wav",
  "kick" : "./sounds/kicks/kick.wav",

}, {"volume" : -15, "fadeOut": "64n"}).toMaster();

var synth = new Tone.Synth().toMaster()

var loop = new Tone.Sequence(function(time, row) {
    for (var i = 0; i < 8; i++) {
        //console.log(drums.matrix.pattern[i][row]);
        if (drums.matrix.pattern[i][row] == 1) {
            //console.log(notes[i]);
            kitSounds.get(kit[i]).start(time, 0, '1n', 0, 0.5);
        }
    }


}
, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], '16n');





// kick channel:

var kick =   kitSounds.get('kick') //get the player
var kickSolo = new Tone.Solo(); //add a solo button
var kickVolume = new Tone.Volume([ volume = -15 ]); //add a volume control
var kickSoloButton = new Nexus.TextButton('#kick-channel', { //create the solo button UI
  'size': [40,40],
'alternateText': 'S',
'state': false,
'text': 'S'
})

var kickMuteButton = new Nexus.TextButton('#kick-channel', { //create the mute button UI
  'size': [40,40],
'alternateText': 'M',
'state': false,
'text': 'M'
})

var kickSelector = new Nexus.Select('#kick-selector',{ //instrument selector UI
  'size': [80,40],
  'options': ['kick','kick2']
})

var kickClear = new Nexus.TextButton ('#kick-channel', { //create the clear button ui
  'size': [40,40],
'mode': 'aftertouch',
'state': false,
'text': 'C'
})

  kick.chain(kickVolume, kickSolo,  Tone.Master); //connect the volume and solo buttons

  kickSoloButton.on('change', function(v) { //activate the solo button
    kickSolo.solo = v;
    console.log(v);

  })
  kickMuteButton.on('change', function(v) { //activate the mute button
    kick.mute = v;
  })

  kickClear.on('change', function(v) { //activate the clear button
    drums.matrix.populate.row(7, [0,0])

  })
  kickSelector.on('change', function(v) { //selector
      kitSounds.get('kick').load("./sounds/kicks/" + v.value + ".wav");
    })

//snare channel:
var snare =   kitSounds.get('snare')
var snareSolo = new Tone.Solo();
var snareVolume = new Tone.Volume([ volume = -15 ]);

var snareSoloButton = new Nexus.Button('#snare-options', {
  'size': [40,40],
'mode': 'toggle',
'state': false
})
snare.chain(snareVolume, snareSolo,  Tone.Master);

snareSoloButton.on('change', function(v) {
  snareSolo.solo = v;

  })











Tone.Transport.bpm.value = 110;

Tone.Transport.start();
loop.start();

});
// ####################################SOCKETS####################################

//
//  // sequencer.on('change', function(v) {
//  //     console.log(v);
//  // });
// //saves the value of the note into the variable
//  drums.on('change', function(v) {
//    // noteChange = v;
//    socket.emit("note_on", v);
//  });
//   //Upon clicking on a child of #drums, emit with the noteChange object
//   // $('#drums').children().click(function() {
//   //
//   // })
// //receive the broadcast and toggle the cell
//   socket.on('add_note', function(data) {
//     console.log("note change received from server", data);
//     if (drums.matrix.pattern[data.row][data.column] != data.state ) { //if the pattern value is already true, don't toggle
//       drums.matrix.toggle.cell(data.column, data.row);
//     }
//     // console.log("column:", data.column);
//     // console.log("row", data.row);
//   })
//
//
//   kickSelector.on('change', function(v) {
//     console.log("change", v.value)
//     kitSounds.get('kick').load("./sounds/" + v.value + ".wav");
//   console.log(kitSounds.get('kick'));
//   })
//


// ####################################END SOCKETS####################################


    </script>
</body>
</html>
